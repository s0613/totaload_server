# TOTALOAD í”„ë¡œì íŠ¸ í†µí•© ë¶„ì„ ë³´ê³ ì„œ

## ğŸ“Œ ìš”ì•½

í˜„ì¬ **Flutter ì•±(app_totaload)**, **Next.js ì›¹(web_totaload)**, **Spring Boot ë°±ì—”ë“œ(iso-platform)** ê°„ì˜ í†µí•©ì— **ì¤‘ëŒ€í•œ ë¬¸ì œì **ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ê°€ì¥ í° ë¬¸ì œëŠ” **ì¸ì¦ ë°©ì‹ ì„¤ê³„ ì˜¤ë¥˜**ë¡œ ì¸í•´ ì•±ì—ì„œ ì¸ì¦ì„œ ëª©ë¡ ì¡°íšŒê°€ ì‹¤íŒ¨í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

---

## ğŸ”´ í•µì‹¬ ë¬¸ì œì  (ì¦‰ì‹œ í•´ê²° í•„ìš”)

### 1. **ì¸ì¦ ë°©ì‹ ì´ì¤‘í™” ë¬¸ì œ âš ï¸**

**ë¬¸ì œ ìƒí™©:**
- ë°±ì—”ë“œ **Security Filter**ì—ì„œ ì´ë¯¸ `authenticated()` ë¡œ ë¡œê·¸ì¸ ì¸ì¦ ìš”êµ¬
- ë™ì‹œì— **Controller**ì—ì„œ `@RequestHeader("X-API-KEY")` ë¡œ API Key ì¶”ê°€ ìš”êµ¬
- ê²°ê³¼ì ìœ¼ë¡œ **ì´ì¤‘ ì¸ì¦**ì´ ë˜ì–´ ë¶ˆí•„ìš”í•˜ê²Œ ë³µì¡í•´ì§

**í˜„ì¬ ì¸ì¦ êµ¬ì¡° ë¶„ì„:**

| ê²½ë¡œ | Security Filter | Controller ë ˆë²¨ | ë¬¸ì œì  |
|------|-----------------|-----------------|--------|
| `GET /api/certificates` | `authenticated()` | `X-API-KEY` í•„ìˆ˜ | ì´ì¤‘ ì¸ì¦ |
| `GET /api/certificates/{id}` | `authenticated()` | `X-API-KEY` í•„ìˆ˜ | ì´ì¤‘ ì¸ì¦ |
| `POST /api/photos/**` | `authenticated()` + ApiKeyFilter | API Key í•„ìˆ˜ | ì •ìƒ |
| `POST /api/checklists/**` | `authenticated()` + ApiKeyFilter | API Key í•„ìˆ˜ | ì •ìƒ |

**ì¦ê±° ì½”ë“œ:**

```java
// SecurityConfig.java - ì´ë¯¸ ì¸ì¦ ìš”êµ¬
.authorizeHttpRequests(authorize -> authorize
    .anyRequest().authenticated()  // â† ë¡œê·¸ì¸ í•„ìš”!
)
```

```java
// CertificateController.java - ì¶”ê°€ë¡œ API Key ìš”êµ¬
@GetMapping
public ResponseEntity<List<CertificateResponse>> getAllCertificates(
    @RequestHeader("X-API-KEY") String apiKey) {  // â† ë¶ˆí•„ìš”í•œ ì´ì¤‘ ì¸ì¦!
    // ...
}
```

**ì˜í–¥:**
- ì•±ì—ì„œ ì¸ì¦ì„œ ëª©ë¡ ì¡°íšŒ ì‹œ **401 Unauthorized ì—ëŸ¬ ë°œìƒ**
- ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë„ API Key ì—†ìœ¼ë©´ ì ‘ê·¼ ë¶ˆê°€
- API Keyë¥¼ ì•±ì— ì €ì¥í•´ì•¼ í•˜ëŠ” **ë³´ì•ˆ ìœ„í—˜** ë°œìƒ

---

### 2. ~~Next.js í”„ë¡ì‹œ ì„¤ì • ëˆ„ë½~~ âœ… **í•´ê²°ë¨**

**í˜„ì¬ ìƒíƒœ:** í”„ë¡ì‹œ ì„¤ì •ì´ ì´ë¯¸ ì™„ë£Œë˜ì–´ ìˆìŠµë‹ˆë‹¤.

```typescript
// web_totaload/next.config.ts (í˜„ì¬ ì„¤ì •ë¨)
async rewrites() {
  return [
    {
      source: '/api/:path*',
      destination: 'http://localhost:8080/api/:path*',
    },
  ];
}
```

**ê²°ë¡ :** ì¶”ê°€ ìˆ˜ì • ë¶ˆí•„ìš”

---

### 3. **ë‚ ì§œ í˜•ì‹ ë¶ˆì¼ì¹˜ ğŸ“…**

**ë¬¸ì œ ìƒí™©:**
- ë°±ì—”ë“œëŠ” ë‚ ì§œë¥¼ ë°°ì—´ í˜•ì‹ìœ¼ë¡œ ë°˜í™˜: `[2024, 11, 23, 10, 30, 0, 0]`
- ì•±ê³¼ ì›¹ì€ ISO 8601 ë¬¸ìì—´ í˜•ì‹ ê¸°ëŒ€: `"2024-11-23T10:30:00Z"`

**ì˜í–¥:**
- í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì¶”ê°€ì ì¸ ë°ì´í„° ë³€í™˜ ë¡œì§ í•„ìš”
- ë³€í™˜ ê³¼ì •ì—ì„œ ì˜¤ë¥˜ ë°œìƒ ê°€ëŠ¥ì„±

---

## ğŸ’¡ ê¶Œì¥ í•´ê²° ë°©ì•ˆ: ì¸ì¦ ë°©ì‹ ë¶„ë¦¬

### í•µì‹¬ ì›ì¹™

> **ì‚¬ìš©ì ì¸ì¦(OAuth2/ì„¸ì…˜)**ê³¼ **API Key ì¸ì¦**ì„ ìš©ë„ì— ë§ê²Œ ë¶„ë¦¬

| ì¸ì¦ ë°©ì‹ | ìš©ë„ | ëŒ€ìƒ API |
|-----------|------|----------|
| **ì‚¬ìš©ì ì¸ì¦** (OAuth2/ì„¸ì…˜) | ì•±/ì›¹ ì‚¬ìš©ì | ì¸ì¦ì„œ ì¡°íšŒ, êµ¬ë§¤, ë‚´ ëª©ë¡ |
| **API Key** | ì™¸ë¶€ ì‹œìŠ¤í…œ, ì„œë²„-ì„œë²„ í†µì‹  | ì¸ì¦ì„œ ë°œê¸‰, ì—…ë¡œë“œ, ì²´í¬ë¦¬ìŠ¤íŠ¸ ì œì¶œ |

### ì¸ì¦ ë°©ì‹ ë¶„ë¦¬ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ì¸ì¦ ë°©ì‹ ë¶„ë¦¬ ì„¤ê³„                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   ì‚¬ìš©ì ì¸ì¦ (OAuth2)    â”‚    â”‚    API Key ì¸ì¦          â”‚    â”‚
â”‚  â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚    â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚    â”‚
â”‚  â”‚                         â”‚    â”‚                         â”‚    â”‚
â”‚  â”‚  ì•±/ì›¹ ì‚¬ìš©ì ì „ìš©        â”‚    â”‚  ì™¸ë¶€ ì‹œìŠ¤í…œ/ìë™í™” ì „ìš©   â”‚    â”‚
â”‚  â”‚                         â”‚    â”‚                         â”‚    â”‚
â”‚  â”‚  â€¢ GET /certificates    â”‚    â”‚  â€¢ POST /certificates/   â”‚    â”‚
â”‚  â”‚  â€¢ GET /certificates/id â”‚    â”‚         issue            â”‚    â”‚
â”‚  â”‚  â€¢ GET /my-issued       â”‚    â”‚  â€¢ POST /certificates/   â”‚    â”‚
â”‚  â”‚  â€¢ POST /id/issue       â”‚    â”‚         upload           â”‚    â”‚
â”‚  â”‚    (êµ¬ë§¤ ìš”ì²­)           â”‚    â”‚  â€¢ POST /certificates/   â”‚    â”‚
â”‚  â”‚                         â”‚    â”‚         generate         â”‚    â”‚
â”‚  â”‚                         â”‚    â”‚  â€¢ POST /from-checklist  â”‚    â”‚
â”‚  â”‚                         â”‚    â”‚  â€¢ POST /photos/**       â”‚    â”‚
â”‚  â”‚                         â”‚    â”‚  â€¢ POST /checklists/**   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì¥ì 

1. **ë³´ì•ˆ í–¥ìƒ**: API Keyë¥¼ ì•±ì— ì €ì¥í•  í•„ìš” ì—†ìŒ
2. **ì‚¬ìš©ì ì¶”ì **: ê°œì¸ë³„ ì„¸ì…˜ìœ¼ë¡œ "ëˆ„ê°€ ìš”ì²­í–ˆëŠ”ì§€" ëª…í™•íˆ íŒŒì•…
3. **ê¶Œí•œ ì œì–´**: `@PreAuthorize`ë¡œ ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´ ê°€ëŠ¥
4. **ë‹¨ìˆœí™”**: í´ë¼ì´ì–¸íŠ¸ì—ì„œ API Key ê´€ë¦¬ ë¶ˆí•„ìš”

---

## ğŸ”§ êµ¬ì²´ì  ìˆ˜ì • ì‚¬í•­

### 1. **ë°±ì—”ë“œ - CertificateController.java ìˆ˜ì •**

API Key ê²€ì¦ ì œê±° ëŒ€ìƒ:

```java
// âŒ Before (í˜„ì¬ - ì´ì¤‘ ì¸ì¦)
@GetMapping
public ResponseEntity<List<CertificateResponse>> getAllCertificates(
    @RequestHeader("X-API-KEY") String apiKey) {
    ApiKeyService.ApiKeyValidationResult validationResult =
        apiKeyService.validateApiKeyWithDetails(apiKey);
    if (!validationResult.isValid()) {
        return ResponseEntity.status(401).build();
    }
    // ...
}

// âœ… After (ê¶Œì¥ - ì‚¬ìš©ì ì¸ì¦ë§Œ)
@GetMapping
public ResponseEntity<List<CertificateResponse>> getAllCertificates() {
    // Spring Securityê°€ ì´ë¯¸ ì¸ì¦ ì²˜ë¦¬í•¨
    try {
        List<CertificateResponse> certificates = certificateService.getAllCertificates();
        return ResponseEntity.ok(certificates);
    } catch (Exception e) {
        log.error("ì¸ì¦ì„œ ì „ì²´ ì¡°íšŒ ì‹¤íŒ¨", e);
        return ResponseEntity.internalServerError().build();
    }
}
```

**ìˆ˜ì • ëŒ€ìƒ ì—”ë“œí¬ì¸íŠ¸:**

| ì—”ë“œí¬ì¸íŠ¸ | í˜„ì¬ | ë³€ê²½ í›„ |
|-----------|------|---------|
| `GET /api/certificates` | API Key + ë¡œê·¸ì¸ | ë¡œê·¸ì¸ë§Œ |
| `GET /api/certificates/{id}` | API Key + ë¡œê·¸ì¸ | ë¡œê·¸ì¸ë§Œ |
| `GET /api/certificates/my-issued` | API Key + ë¡œê·¸ì¸ | ë¡œê·¸ì¸ë§Œ |
| `GET /api/certificates/issued-by/{userId}` | API Key + ë¡œê·¸ì¸ | ë¡œê·¸ì¸ë§Œ |
| `GET /api/certificates/{id}/issuers` | API Key + ë¡œê·¸ì¸ | ë¡œê·¸ì¸ë§Œ |
| `POST /api/certificates/{id}/issue` | API Key + ë¡œê·¸ì¸ | ë¡œê·¸ì¸ë§Œ |

**API Key ìœ ì§€ ì—”ë“œí¬ì¸íŠ¸:**

| ì—”ë“œí¬ì¸íŠ¸ | ìš©ë„ |
|-----------|------|
| `POST /api/certificates/issue` | ì™¸ë¶€ ì‹œìŠ¤í…œ ì¸ì¦ì„œ ë°œê¸‰ |
| `POST /api/certificates/upload` | PDF ì—…ë¡œë“œ |
| `POST /api/certificates/generate` | ì¸ì¦ì„œ ìƒì„± |
| `POST /api/certificates/from-checklist` | ì²´í¬ë¦¬ìŠ¤íŠ¸â†’ì¸ì¦ì„œ |

---

### 2. ~~Next.js - í”„ë¡ì‹œ ì„¤ì • ì¶”ê°€~~ âœ… **ì´ë¯¸ ì™„ë£Œë¨**

í”„ë¡ì‹œ ì„¤ì •ì´ ì´ë¯¸ `next.config.ts`ì™€ `next.config.mjs`ì— êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
ì¶”ê°€ ìˆ˜ì •ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

---

### 3. **ë°±ì—”ë“œ - ë‚ ì§œ í˜•ì‹ í‘œì¤€í™”**

```java
// Certificate.java ë˜ëŠ” CertificateResponse.java ìˆ˜ì •

@JsonFormat(shape = JsonFormat.Shape.STRING,
           pattern = "yyyy-MM-dd'T'HH:mm:ss'Z'")
private LocalDateTime issueDate;

@JsonFormat(shape = JsonFormat.Shape.STRING,
           pattern = "yyyy-MM-dd'T'HH:mm:ss'Z'")
private LocalDateTime expireDate;

@JsonFormat(shape = JsonFormat.Shape.STRING,
           pattern = "yyyy-MM-dd'T'HH:mm:ss'Z'")
private LocalDateTime inspectDate;
```

---

## ğŸ“Š í”„ë¡œì íŠ¸ë³„ í˜„ì¬ ìƒíƒœ

### Flutter ì•± (app_totaload) âœ… **ìˆ˜ì • ë¶ˆí•„ìš”**
- âœ… **ì´ë¯¸ ì •ìƒ**: ì¸ì¦ì„œ ì¡°íšŒ APIëŠ” API Key ì—†ì´ í˜¸ì¶œ ì¤‘
- âœ… **ì´ë¯¸ ì •ìƒ**: OAuth2 ë¡œê·¸ì¸ìœ¼ë¡œ ì¸ì¦ì„œ ì¡°íšŒ
- âœ… **ì´ë¯¸ ì •ìƒ**: ì²´í¬ë¦¬ìŠ¤íŠ¸/ì‚¬ì§„ ì—…ë¡œë“œëŠ” API Key ì‚¬ìš© ì¤‘
- âš ï¸ **ì„ íƒì‚¬í•­**: ë°±ì—”ë“œ ë‚ ì§œ í˜•ì‹ ìˆ˜ì • í›„ ë³€í™˜ ë¡œì§ ë‹¨ìˆœí™” ê°€ëŠ¥

### Next.js ì›¹ (web_totaload) âœ… **ìˆ˜ì • ë¶ˆí•„ìš”**
- âœ… **ì´ë¯¸ ì™„ë£Œ**: `next.config.ts` í”„ë¡ì‹œ ì„¤ì • ì™„ë£Œë¨
- âœ… **ì´ë¯¸ ì •ìƒ**: OAuth2 ë¡œê·¸ì¸ìœ¼ë¡œ ì¸ì¦ì„œ ì¡°íšŒ/êµ¬ë§¤
- âš ï¸ **ì°¸ê³ **: `next.config.ts`ì™€ `next.config.mjs` ì¤‘ë³µ ì¡´ì¬ (í†µí•© ê¶Œì¥)

### Spring Boot ë°±ì—”ë“œ (iso-platform) âš ï¸ **ìˆ˜ì • í•„ìš”**
- âŒ **ë³€ê²½ í•„ìš”**: CertificateControllerì—ì„œ ì¡°íšŒ APIì˜ API Key ê²€ì¦ ì œê±°
- âœ… **ìœ ì§€**: ì™¸ë¶€ ì‹œìŠ¤í…œìš© APIì—ì„œ API Key ê²€ì¦ ìœ ì§€
- âš ï¸ **ê¶Œì¥**: ë‚ ì§œ ì§ë ¬í™” í˜•ì‹ì„ ISO 8601ë¡œ ìˆ˜ì •

---

## ğŸš€ ê¶Œì¥ ì‘ì—… ìˆœì„œ

1. **[ê¸´ê¸‰]** ë°±ì—”ë“œ CertificateController ìˆ˜ì • - API Key ê²€ì¦ ì œê±°
   - ê³„íš: `iso-platform/docs/plans/2025-11-23-remove-apikey-from-certificate-queries.md`
2. **[ê¶Œì¥]** ë°±ì—”ë“œ ë‚ ì§œ í˜•ì‹ ìˆ˜ì • - ISO 8601 ë¬¸ìì—´ë¡œ ë³€ê²½
   - ê³„íš: `iso-platform/docs/plans/2025-11-23-fix-date-serialization-format.md`
3. **[í…ŒìŠ¤íŠ¸]** ì „ì²´ ì—°ë™ í…ŒìŠ¤íŠ¸

**ì°¸ê³ :** Flutter ì•±ê³¼ Next.js ì›¹ì€ ì´ë¯¸ ì˜¬ë°”ë¥´ê²Œ êµ¬í˜„ë˜ì–´ ìˆì–´ ìˆ˜ì • ë¶ˆí•„ìš”

---

## ğŸ“ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### ì•± í…ŒìŠ¤íŠ¸
1. OAuth2 ë¡œê·¸ì¸ (Google/Kakao)
2. ì¸ì¦ì„œ ëª©ë¡ ì¡°íšŒ â†’ **API Key ì—†ì´ ì„±ê³µí•´ì•¼ í•¨**
3. ì¸ì¦ì„œ ìƒì„¸ ì¡°íšŒ â†’ **ì •ìƒ í‘œì‹œ**
4. ì°¨ëŸ‰ ë“±ë¡ â†’ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì‘ì„± â†’ **ì„±ê³µí•´ì•¼ í•¨**

### ì›¹ í…ŒìŠ¤íŠ¸
1. OAuth2 ë¡œê·¸ì¸
2. ì¸ì¦ì„œ ëª©ë¡ í˜ì´ì§€ ì ‘ì† â†’ **ëª©ë¡ì´ í‘œì‹œë˜ì–´ì•¼ í•¨**
3. ì¸ì¦ì„œ ìƒì„¸ ì¡°íšŒ â†’ **ì •ìƒ í‘œì‹œ**
4. ì¸ì¦ì„œ êµ¬ë§¤ ìš”ì²­ â†’ **ì„±ê³µí•´ì•¼ í•¨**
5. PDF ë‹¤ìš´ë¡œë“œ â†’ **ì •ìƒ ë‹¤ìš´ë¡œë“œ**

---

## ê²°ë¡ 

í˜„ì¬ ê°€ì¥ ì‹œê¸‰í•œ ë¬¸ì œëŠ” **ë°±ì—”ë“œì˜ ì¸ì¦ ë°©ì‹ ì´ì¤‘í™”**ì…ë‹ˆë‹¤.

**í•µì‹¬ ë°œê²¬:**
- Flutter ì•±: ì´ë¯¸ ì˜¬ë°”ë¥´ê²Œ êµ¬í˜„ë¨ (ì¸ì¦ì„œ ì¡°íšŒ ì‹œ API Key ë¯¸ì‚¬ìš©)
- Next.js ì›¹: ì´ë¯¸ í”„ë¡ì‹œ ì„¤ì • ì™„ë£Œë¨
- Spring Boot ë°±ì—”ë“œ: **ìœ ì¼í•˜ê²Œ ìˆ˜ì • í•„ìš”** (API Key ê²€ì¦ ì œê±°)

**ê¶Œì¥ í•´ê²°ì±…:**
- ì¸ì¦ì„œ ì¡°íšŒ/êµ¬ë§¤ API â†’ **ì‚¬ìš©ì ì¸ì¦(OAuth2)ë§Œ ì‚¬ìš©**
- ì™¸ë¶€ ì‹œìŠ¤í…œ ì—°ë™ API â†’ **API Key ìœ ì§€**

**ë°±ì—”ë“œ Controller ìˆ˜ì •ë§Œìœ¼ë¡œ ì¦‰ì‹œ í•´ê²° ê°€ëŠ¥í•©ë‹ˆë‹¤.**

---

## ğŸ“ ìƒì„±ëœ êµ¬í˜„ ê³„íš ë¬¸ì„œ

| í”„ë¡œì íŠ¸ | ê³„íš ë¬¸ì„œ | ìƒíƒœ |
|---------|----------|------|
| iso-platform | `docs/plans/2025-11-23-remove-apikey-from-certificate-queries.md` | ìˆ˜ì • í•„ìš” |
| iso-platform | `docs/plans/2025-11-23-fix-date-serialization-format.md` | ê¶Œì¥ |
| app_totaload | `docs/plans/2025-11-23-verification-no-changes-needed.md` | ìˆ˜ì • ë¶ˆí•„ìš” |
| web_totaload | `docs/plans/2025-11-23-verification-proxy-already-configured.md` | ìˆ˜ì • ë¶ˆí•„ìš” |
